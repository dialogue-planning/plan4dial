---
name: medical_bot
context_variables:
  have-symptoms:
    type: flag
    init: false
    known:
      type: flag
      init: false
  symptoms:
    type: enum
    known:
      type: flag
      init: false
    options:
      - covid
      - rash
      - teeth
  over-week:
    type: flag
    init: false
    known:
      type: flag
      init: false    
  covid-exposure:
    type: flag
    init: false
    known:
      type: flag
      init: false
  exposure-period-over-5:
    type: flag
    init: false
    known:
      type: flag
      init: false
  positive-30:
    type: flag
    init: false
    known:
      type: flag
      init: false
  positive-90:
    type: flag
    init: false
    known:
      type: flag
      init: false
  need-reg-diag:
    type: flag
    init: false
    known:
      type: flag
      init: false
  need-covid-diag:
    type: flag
    init: false
    known:
      type: flag
      init: false  
  ran-reg-diag:
    type: flag
    init: false
  ran-covid-diag:
    type: flag
    init: false
  no-covid-symptoms:
    type: flag
    init: false
  completed-diagnostics:
    type: flag
    init: false
  goal:
    type: flag
    init: false

intents:
  confirm:
    utterances:
      - "yes"
      - yeah
      - "Y"
      - mhm
      - confirm
      - yes please
      - yup
      - uh huh
      - ya
  deny:
    utterances:
      - "no"
      - not at all
      - absolutely not
      - nah
      - no thanks
      - no thank you
      - nope
      - nuh uh
  share_covid_symptoms:
    utterances:
      - I am experiencing covid symptoms.
      - I have a fever
      - I'm having chills
      - I am coughing
      - I am fatigued
      - My muscles ache
      - My head hurts
      - I can't taste or smell anymore
      - I have a sore throat
      - My nose is stuffy
      - I have an upset stomach
  share_rash_symptoms:
    utterances:
      - My skin is breaking out
      - My face is breaking out
      - My skin feels red and itchy
      - The skin on my face is swollen
      - My leg is red and blistering
      - My skin is sensitive
      - My skin is sensitive to the touch
  share_teeth_symptoms:
    utterances:
      - My teeth hurt
      - I have a toothache
      - It hurts when I drink cold liquids
      - My gums are too sensitive
      - My gums hurt when I drink
      - I think I have a cavity
      - It hurts to eat

actions:
  get_have_symptoms:
    type: custom
    subtype: flag_entity_yes_no
    parameters:
      action_name: get_have_symptoms
      entity: have-symptoms
      message_variants:
        - Are you experiencing symptoms of any kind? (Answer yes or no).
        - Are you feeling ill? (Please answer yes or no).
      additional_updates:
        deny_outcome:
          updates:
            symptoms:
              known: true
              value: null
        confirm_outcome:
          response_variants:
            - I'm sorry to hear you are feeling unwell!
  get_symptoms:
    type: dialogue
    message_variants:
      - What symptoms are you feeling?
      - Please describe the symptoms you are experiencing.
      - What is it that you are feeling?
    fallback_message_variants:
      - Sorry, I don't recognize those symptoms.
    condition:
      have-symptoms:
        value: true
      symptoms:
        known: false
    effect:
      get-symptoms:
        oneof:
          outcomes:
            share-covid:
              updates:
                no-covid-symptoms:
                  value: false
                symptoms:
                  known: true
                  value: covid
              intent: share_covid_symptoms
            share-rash:
              updates:
                no-covid-symptoms:
                  value: true
                symptoms:
                  known: true
                  value: rash
              intent: share_rash_symptoms
            share-teeth:
              updates:
                no-covid-symptoms:
                  value: true
                symptoms:
                  known: true
                  value: teeth
              intent: share_teeth_symptoms
  progress_no_symptoms_cases:
    type: system
    subtype: Context dependent determination
    condition:
      covid-exposure:
        known: true
      have-symptoms:
        known: true
        value: false
      need-covid-diag:
        known: false
      completed-diagnostics:
        value: false
    effect:
      check-test:
        oneof:
          outcomes:
            no-exposure-no-symptoms:
              updates:
                completed-diagnostics:
                  value: true
              response_variants:
                - Since you have no symptoms and have not been exposed to COVID-19, no further action is required.
              context:
                covid-exposure:
                  value: false
            proceed:
              updates:
                no-covid-symptoms:
                  value: true
                need-covid-diag:
                  known: true
                  value: true 
                need-reg-diag:
                  known: true
                  value: false
              context:
                covid-exposure:
                  value: true
              response_variants:
                - Running diagnostics...
  get_sickness_period:
    type: custom
    subtype: flag_entity_yes_no
    parameters:
      action_name: get_sickness_period
      entity: over-week
      message_variants:
        - Have you been experiencing symptoms for over a week?
        - Have you been feeling ill for more than a week?
        - Have you had these symptoms for over a week?
      additional_conditions:
        have-symptoms:
          value: true
  progress_symptoms_cases:
    type: system
    subtype: Context dependent determination
    condition:
      have-symptoms:
        value: true
      symptoms:
        known: true
      covid-exposure:
        known: true
      need-covid-diag:
        known: false
      need-reg-diag:
        known: false
    effect:
      check-test:
        oneof:
          outcomes:
            covid:
              updates:
                need-covid-diag:
                  known: true
                  value: true
                need-reg-diag:
                  known: true
                  value: false
              context:
                symptoms:
                  value: covid
            rash-covid:
              updates:
                need-reg-diag:
                  known: true
                  value: true
                need-covid-diag:
                  known: true
                  value: true
              follow_up: diagnose_regular_sickness
              context:
                symptoms:
                  value: rash
                covid-exposure:
                  value: true
            teeth-covid:
              updates:
                need-reg-diag:
                  known: true
                  value: true
                need-covid-diag:
                  known: true
                  value: true
              follow_up: diagnose_regular_sickness
              context:
                symptoms:
                  value: teeth
                covid-exposure:
                  value: true
            rash-no-covid:
              updates:
                need-covid-diag:
                  known: true
                  value: false
                need-reg-diag:
                  known: true
                  value: true
              context:
                symptoms:
                  value: rash
                covid-exposure:
                  value: false
            teeth-no-covid:
              updates:
                need-covid-diag:
                  known: true
                  value: false
                need-reg-diag:
                  known: true
                  value: true
              context:
                symptoms:
                  value: teeth
                covid-exposure:
                  value: false
  diagnose_regular_sickness:
    type: system
    subtype: Context dependent determination
    condition:
      need-reg-diag:
        value: true
      over-week:
        known: true
      ran-reg-diag:
        value: false
    effect:
      check-test:
        oneof:
          outcomes:
            rash-under:
              updates:
                ran-reg-diag:
                  value: true
              response_variants:
                - Concerning your rash, if you are having trouble breathing, your face is throat is tight, or your face is swelling up, call emergency. Use warm (not hot) water to clean the area (without scrubbing). If this was potentially the result of a product, stop using it immediately. Try a medicated lotion on the area.
              context:
                symptoms:
                  value: rash
                over-week:
                  value: false
            rash-over:
              updates:
                ran-reg-diag:
                  value: true
              response_variants:
                - Concerning your rash, contact your health care provider. Before you go, take mental note of when the rash began, what products you have been using recently/any possible insect bites, and what made it better/worse.
              context:
                symptoms:
                  value: rash
                over-week:
                  value: true
            teeth:
              updates:
                ran-reg-diag:
                  value: true
              response_variants:
                - To address your teeth, I sent you an email detailing the nearest appointments of dentists in your area.
              context:
                symptoms:
                  value: teeth
  get_covid_exposure:
    type: custom
    subtype: flag_entity_yes_no
    parameters:
      action_name: get_covid_exposure
      entity: covid-exposure
      message_variants:
        - Have you been exposed to COVID-19?
        - Have you been notified with a COVID-19 exposure?
        - Have you been in contact or close to someone with COVID-19?
  get_exposure_period:
    type: custom
    subtype: flag_entity_yes_no
    parameters:
      action_name: get_exposure_period
      entity: exposure-period-over-5
      message_variants:
        - Has it been at least 5 days since you were exposed to COVID-19?
        - Has it been at least 5 days since your exposure to COVID-19?
      additional_conditions:
        covid-exposure:
          known: true
        need-covid-diag:
          value: true
  get_positive_30:
    type: custom
    subtype: flag_entity_yes_no
    parameters:
      action_name: get_positive_30
      entity: positive-30
      message_variants:
        - Have you tested positive for COVID-19 in the last 30 days?
        - Have you contracted COVID-19 in the last 30 days?
      additional_conditions:
        need-covid-diag:
          value: true
      additional_updates:
        confirm_outcome:
          updates:
            positive-90:
              known: true
              value: true
  get_positive_90:
    type: custom
    subtype: flag_entity_yes_no
    parameters:
      action_name: get_positive_90
      entity: positive-90
      message_variants:
        - What about in the last 90 days?
        - How about in the last 90 days?
      additional_conditions:
        positive-30:
          known: true
          value: false
  determine_covid_test:
    type: system
    subtype: Context dependent determination
    condition:
      need-covid-diag:
        value: true
      covid-exposure:
        known: true
      symptoms:
        known: true
      exposure-period-over-5:
        known: true
      positive-90:
        known: true
      positive-30:
        known: true
      ran-covid-diag:
        value: false
    effect:
      check-test:
        oneof:
          outcomes:
            have-no-symptoms-30:
              updates:
                ran-covid-diag:
                  value: true
              response_variants:
                - Since you have had COVID-19 in the last 30 days or less, testing is not recommended as you have no covid symptoms.
              context:
                no-covid-symptoms:
                  value: true
                positive-30:
                  value: true
                exposure-period-over-5:
                  value: true
            have-symptoms-30:
              updates:
                ran-covid-diag:
                  value: true
              response_variants:
                - Since you have covid symptoms and have had COVID-19 in the last 30 days or less, you should use antigen tests according to the suggested testing guidelines.
              context:
                symptoms:
                  value: covid
                positive-30:
                  value: true
            have-symptoms-no-90:
              updates:
                ran-covid-diag:
                  value: true
              response_variants:
                - Since you have covid symptoms and have not had COVID-19 in the last 90 days, you should test immediately. You can use either a PCR test or take antigen tests according to the suggested testing guidelines.
              context:
                symptoms:
                  value: covid
                positive-90:
                  value: false
            have-symptoms-90:
              updates:
                ran-covid-diag:
                  value: true
              response_variants:
                - Since you have covid symptoms and have had COVID-19 in the last 90 days, you should use antigen tests according to the suggested testing guidelines.
              context:
                symptoms:
                  value: covid
                positive-90:
                  value: true
                positive-30:
                  value: false
            have-no-symptoms-90:
              updates:
                ran-covid-diag:
                  value: true
              response_variants:
                - Although you have had COVID-19 in the last 90 days and don't have covid symptoms, you should still use antigen tests according to the suggested testing guidelines.
              context:
                no-covid-symptoms:
                  value: true
                positive-90:
                  value: true
                positive-30:
                  value: false
                exposure-period-over-5:
                  value: true
            no-symptom-exposed-been-5:
              updates:
                ran-covid-diag:
                  value: true
              response_variants:
                - Although you don't have covid symptoms and have not had COVID-19 in the last 90 days, since it has been 5 days, you should test. You can use either a PCR test or take antigen tests according to the suggested testing guidelines.
              context:
                no-covid-symptoms:
                  value: true
                covid-exposure:
                  value: true
                exposure-period-over-5:
                  value: true
                positive-30:
                  value: false
                positive-90:
                  value: false
            no-symptom-exposed-less-5:
              updates:
                ran-covid-diag:
                  value: true
              response_variants:
                - Since you have been exposed to COVID-19 but are not yet showing covid symptoms, wait a total of 5 days since your exposure to test.
              context:
                no-covid-symptoms:
                  value: true
                covid-exposure:
                  value: true
                exposure-period-over-5:
                  value: false
  got-both-diags:
    type: system
    condition:
      need-covid-diag:
        known: true
        value: true
      need-reg-diag:
        known: true
        value: true
      ran-covid-diag:
        value: true
      ran-reg-diag:
        value: true
      completed-diagnostics:
        value: false
    effect:
      check-test:
        oneof:
          outcomes:   
            complete:
              updates:
                completed-diagnostics:
                  value: true
  got-covid-diag:
    type: system
    condition:
      need-covid-diag:
        known: true
        value: true
      need-reg-diag:
        known: true
        value: false
      ran-covid-diag:
        value: true
      completed-diagnostics:
        value: false
    effect:
      check-test:
        oneof:
          outcomes:   
            complete:
              updates:
                completed-diagnostics:
                  value: true
  got-reg-diag:
    type: system
    condition:
      need-covid-diag:
        known: true
        value: false
      need-reg-diag:
        known: true
        value: true
      ran-reg-diag:
        value: true
      completed-diagnostics:
        value: false
    effect:
      check-test:
        oneof:
          outcomes:   
            complete:
              updates:
                completed-diagnostics:
                  value: true
                
  complete:
    type: system
    condition:
      completed-diagnostics:
        value: true
    effect:
      finish:
        oneof:
          outcomes:
            finish:
              updates:
                goal:
                  value: true
...
