---
name: medical_bot
context_variables:
  have-symptoms:
    type: flag
    init: false
    known:
      type: flag
      init: false
  symptoms:
    type: enum
    known:
      type: flag
      init: false
    options:
      - covid
      - rash
      - teeth
  over-week:
    type: flag
    init: false
    known:
      type: flag
      init: false    
  covid-exposure:
    type: flag
    init: false
    known:
      type: flag
      init: false
  exposure-period-over-5:
    type: flag
    init: false
    known:
      type: flag
      init: false
  positive-30:
    type: flag
    init: false
    known:
      type: flag
      init: false
  positive-90:
    type: flag
    init: false
    known:
      type: flag
      init: false
  non-covid-illness:
    type: flag
    init: false
    known:
      type: flag
      init: false
  completed-diagnostic:
    type: flag
    init: false
  goal:
    type: flag
    init: false

intents:
  confirm:
    utterances:
      - "yes"
      - yeah
      - "Y"
      - mhm
      - confirm
      - yes please
      - yup
      - uh huh
      - ya
  deny:
    utterances:
      - "no"
      - not at all
      - absolutely not
      - nah
      - no thanks
      - no thank you
      - nope
      - nuh uh
  share_covid_symptoms:
    utterances:
      - I am experiencing covid symptoms.
      - I have a fever
      - I'm having chills
      - I am coughing
      - I am fatigued
      - My muscles ache
      - My head hurts
      - I can't taste or smell anymore
      - I have a sore throat
      - My nose is stuffy
      - I have an upset stomach
  share_rash_symptoms:
    utterances:
      - My skin is breaking out
      - My face is breaking out
      - My skin feels red and itchy
      - The skin on my face is swollen
      - My leg is red and blistering
      - My skin is sensitive
      - My skin is sensitive to the touch
  share_teeth_symptoms:
    utterances:
      - My teeth hurt
      - I have a toothache
      - It hurts when I drink cold liquids
      - My gums are too sensitive
      - My gums hurt when I drink
      - I think I have a cavity
      - It hurts to eat

actions:
  get_have_symptoms:
    type: custom
    subtype: flag_entity_yes_no
    parameters:
      action_name: get_have_symptoms
      entity: have-symptoms
      message_variants:
        - Are you experiencing symptoms of any kind? (Answer yes or no).
      additional_updates:
        deny_outcome:
          updates:
            symptoms:
              known: true
              value: null
        confirm_outcome:
          response_variants:
            - I'm sorry to hear you are feeling unwell.
  get_symptoms:
    type: dialogue
    message_variants:
      - What symptoms are you feeling?
    fallback_message_variants:
      - Sorry, I don't recognize those symptoms.
    condition:
      have-symptoms:
        value: true
    effect:
      get-symptoms:
        oneof:
          outcomes:
            share-covid:
              updates:
                symptoms:
                  known: true
                  value: covid
              intent: share_covid_symptoms
            share-rash:
              updates:
                symptoms:
                  known: true
                  value: rash
              intent: share_rash_symptoms
            share-teeth:
              updates:
                symptoms:
                  known: true
                  value: teeth
              intent: share_teeth_symptoms
  handle_no_issues:
    type: dialogue
    message_variants:
      - Since you have no symptoms and have not been exposed to COVID-19, no further action is required.
    condition:
      covid-exposure:
        known: true
        value: false
      have-symptoms:
        known: true
        value: false
      completed-diagnostic:
        value: false
    effect:
      check-test:
        oneof:
          outcomes:
            no-exposure-no-symptoms:
              updates:
                completed-diagnostic:
                  value: true
  get_sickness_period:
    type: custom
    subtype: flag_entity_yes_no
    parameters:
      action_name: get_sickness_period
      entity: over-week
      message_variants:
        - Have you been experiencing symptoms for over a week?
      additional_conditions:
        have-symptoms:
          value: true
  need-covid-diagnostic-1:
    type: system
    condition:
      symptoms:
        known: true
        value: covid
      non-covid-illness:
        known: false
    effect:
      check-test:
        oneof:
          outcomes:
            covid-symptoms:
              updates:
                non-covid-illness:
                  known: true
                  value: false
  need-covid-diagnostic-2:
    type: system
    condition:
      covid-exposure:
        value: true
      non-covid-illness:
        known: false
    effect:
      check-test:
        oneof:
          outcomes:
            covid-symptoms:
              updates:
                non-covid-illness:
                  known: true
                  value: false
  determine-is-non-covid-illness:
    type: system
    subtype: Context dependent determination
    condition:
      covid-exposure:
        known: true
      symptoms:
        known: true
      non-covid-illness:
        known: false
    effect:
      check-test:
        oneof:
          outcomes:
            rash:
              updates:
                non-covid-illness:
                  known: true
                  value: true
              context:
                symptoms:
                  value: rash
                covid-exposure:
                  value: false
            teeth:
              updates:
                non-covid-illness:
                  known: true
                  value: true
              context:
                symptoms:
                  value: teeth
                covid-exposure:
                  value: false
  diagnose_regular_sickness:
    type: system
    subtype: Context dependent determination
    condition:
      non-covid-illness:
        known: true
        value: true
      over-week:
        known: true
      completed-diagnostic:
        value: false
    effect:
      check-test:
        oneof:
          outcomes:
            rash-under:
              updates:
                completed-diagnostic:
                  value: true
              response_variants:
                - Ok. If you are having trouble breathing, your face is throat is tight, or your face is swelling up, call emergency. Use warm (not hot) water to clean the area (without scrubbing). If this was potentially the result of a product, stop using it immediately. Try a medicated lotion on the area.
              context:
                symptoms:
                  value: rash
                over-week:
                  value: false
            rash-over:
              updates:
                completed-diagnostic:
                  value: true
              response_variants:
                - Contact your health care provider. Before you go, take mental note of when the rash began, what products you have been using recently/any possible insect bites, and what made it better/worse.
              context:
                symptoms:
                  value: rash
                over-week:
                  value: true
            teeth:
              updates:
                completed-diagnostic:
                  value: true
              response_variants:
                - Ok. I sent you an email detailing the nearest appointments of dentists in your area.
              context:
                symptoms:
                  value: teeth

  get_covid_exposure:
    type: custom
    subtype: flag_entity_yes_no
    parameters:
      action_name: get_covid_exposure
      entity: covid-exposure
      message_variants:
        - Have you been exposed to COVID-19?
  get_exposure_period:
    type: custom
    subtype: flag_entity_yes_no
    parameters:
      action_name: get_exposure_period
      entity: exposure-period-over-5
      message_variants:
        - Has it been at least 5 days since you were exposed to COVID-19?
      additional_conditions:
        covid-exposure:
          known: true
        non-covid-illness:
          known: true
          value: false
  get_positive_30:
    type: custom
    subtype: flag_entity_yes_no
    parameters:
      action_name: get_positive_30
      entity: positive-30
      message_variants:
        - Have you tested positive for COVID-19 in the last 30 days?
      additional_conditions:
        non-covid-illness:
          known: true
          value: false
      additional_updates:
        confirm_outcome:
          positive-90:
            known: true
            value: true
  get_positive_90:
    type: custom
    subtype: flag_entity_yes_no
    parameters:
      action_name: get_positive_90
      entity: positive-90
      message_variants:
        - What about in the last 90 days?
      additional_conditions:
        positive-30:
          known: true
  determine_covid_test:
    type: system
    subtype: Context dependent determination
    condition:
      non-covid-illness:
        known: true
        value: false
      covid-exposure:
        known: true
      symptoms:
        known: true
      exposure-period-over-5:
        known: true
      positive-90:
        known: true
      positive-30:
        known: true
      completed-diagnostic:
        value: false
    effect:
      check-test:
        oneof:
          outcomes:   
            no-symptom-exposed-been-5:
              updates:
                completed-diagnostic:
                  value: true
              response_variants:
                - Although you don't have symptoms, since it has been 5 days, you should test.
              context:
                have-symptoms:
                  value: false
                covid-exposure:
                  value: true
                exposure-period-over-5:
                  value: true
            no-symptom-exposed-less-5:
              updates:
                completed-diagnostic:
                  value: true
              response_variants:
                - Since you have been exposed to COVID-19 but are not yet showing symptoms, wait a total of 5 days since your exposure to test.
              context:
                have-symptoms:
                  value: false
                covid-exposure:
                  value: true
                exposure-period-over-5:
                  value: false
            have-symptoms-no-90:
              updates:
                completed-diagnostic:
                  value: true
              response_variants:
                - Since you have symptoms and have not had COVID-19 in the last 90 days, you should test immediately. You can use either a PCR or antigen test.
              context:
                symptoms:
                  value: covid
                positive-90:
                  value: false
            have-symptoms-30:
              updates:
                completed-diagnostic:
                  value: true
              response_variants:
                - Since you have symptoms and have had COVID-19 in the last 30 days or less, you should use an antigen test.
              context:
                symptoms:
                  value: covid
                positive-30:
                  value: true
            have-no-symptoms-30:
              updates:
                completed-diagnostic:
                  value: true
              response_variants:
                - Although you have had COVID-19 in the last 30 days or less, testing is not recommended.
              context:
                have-symptoms:
                  value: false
                positive-30:
                  value: true
            have-symptoms-90:
              updates:
                completed-diagnostic:
                  value: true
              response_variants:
                - Since you have symptoms and have had COVID-19 in the last 90 days, you should use an antigen test.
              context:
                symptoms:
                  value: covid
                positive-90:
                  value: true
            have-no-symptoms-90:
              updates:
                completed-diagnostic:
                  value: true
              response_variants:
                - Although you have had COVID-19 in the last 90 days and don't have symptoms, you should still use an antigen test.
              context:
                have-symptoms:
                  value: false
                positive-90:
                  value: true
  complete:
    type: system
    condition:
      completed-diagnostic:
        value: true
    effect:
      finish:
        oneof:
          outcomes:
            finish:
              updates:
                goal:
                  value: true
...
