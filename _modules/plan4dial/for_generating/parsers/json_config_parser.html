<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>plan4dial.for_generating.parsers.json_config_parser &mdash; Plan4Dial 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Plan4Dial
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../generated/plan4dial.html">plan4dial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial.html">Tutorial</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Plan4Dial</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">plan4dial.for_generating.parsers.json_config_parser</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for plan4dial.for_generating.parsers.json_config_parser</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;This module contains all the base functions required to convert a YAML configuration</span>
<span class="sd">to the JSON configuration required by Hovor.</span>

<span class="sd">Authors:</span>
<span class="sd">- Rebecca De Venezia</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getmembers</span><span class="p">,</span> <span class="n">isfunction</span>
<span class="kn">from</span> <span class="nn">nnf</span> <span class="kn">import</span> <span class="n">Or</span><span class="p">,</span> <span class="n">And</span><span class="p">,</span> <span class="n">Var</span><span class="p">,</span> <span class="n">config</span>
<span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">import_module</span>


<div class="viewcode-block" id="_configure_force_message_true"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._configure_force_message_true">[docs]</a><span class="k">def</span> <span class="nf">_configure_force_message_true</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns:</span>
<span class="sd">    Dict: Configuration where *have-message* and *force-statement* are set to True.</span>
<span class="sd">    Used to force a `dialogue_statement` action.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;have-message&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="s2">&quot;force-statement&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="p">}</span></div>


<div class="viewcode-block" id="_configure_fallback"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._configure_fallback">[docs]</a><span class="k">def</span> <span class="nf">_configure_fallback</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns:</span>
<span class="sd">    Dict: Update configuration for a fallback outcome.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;updates&quot;</span><span class="p">:</span> <span class="n">_configure_force_message_true</span><span class="p">(),</span> <span class="s2">&quot;intent&quot;</span><span class="p">:</span> <span class="s2">&quot;fallback&quot;</span><span class="p">}</span></div>


<div class="viewcode-block" id="_configure_dialogue_statement"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._configure_dialogue_statement">[docs]</a><span class="k">def</span> <span class="nf">_configure_dialogue_statement</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the base `dialogue_statement` action.</span>

<span class="sd">    Most often, the `dialogue_statement` action is triggered when a fallback occurs; in</span>
<span class="sd">    this case, `dialogue_statement` updates its `message_variants` to the appropriate</span>
<span class="sd">    `fallback_message_variants`. Dialogue statements are also used for responses, in</span>
<span class="sd">    which case `dialogue_statement` updates its `message_variants` to the appropriate</span>
<span class="sd">    `response_variants`.</span>

<span class="sd">    Note that the intent *utter_ds* is a blank intent because `message`</span>
<span class="sd">    actions (`dialogue` type actions with a single outcome) do not take user input into</span>
<span class="sd">    account and simply execute the single outcome.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict: The full configuration for the `dialogue_statement` action.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;dialogue&quot;</span><span class="p">,</span>
        <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="n">_configure_force_message_true</span><span class="p">(),</span>
        <span class="s2">&quot;effect&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;reset&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;oneof&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;outcomes&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;lock&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;updates&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;have-message&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="p">},</span>
                                <span class="s2">&quot;force-statement&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="p">},</span>
                            <span class="p">},</span>
                            <span class="s2">&quot;intent&quot;</span><span class="p">:</span> <span class="s2">&quot;utter_ds&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;message_variants&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span></div>


<div class="viewcode-block" id="configure_assignments"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser.configure_assignments">[docs]</a><span class="k">def</span> <span class="nf">configure_assignments</span><span class="p">(</span><span class="n">known</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts the parameter `known` (which is either True, False, or &quot;maybe&quot;) to the</span>
<span class="sd">    equivalent Hovor assignment (&quot;found&quot;, &quot;didnt-find&quot;, and &quot;maybe-found&quot;</span>
<span class="sd">    respectively). Used for outcomes.</span>

<span class="sd">    Args:</span>
<span class="sd">        known (bool or str): The &quot;known&quot; status of a context variable in the YAML.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The Hovor assignment equivalent to the &quot;known&quot; parameter provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;found&quot;</span> <span class="k">if</span> <span class="n">known</span> <span class="k">else</span> <span class="s2">&quot;didnt-find&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">known</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span> <span class="k">else</span> <span class="s2">&quot;maybe-found&quot;</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="_configure_certainty"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._configure_certainty">[docs]</a><span class="k">def</span> <span class="nf">_configure_certainty</span><span class="p">(</span><span class="n">known</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts the parameter `known` (which is either True, False, or &quot;maybe&quot;) to the</span>
<span class="sd">    equivalent Hovor certainty (&quot;Known&quot;, &quot;Unknown&quot;, and &quot;Uncertain&quot; respectively). Used</span>
<span class="sd">    for preconditions.</span>

<span class="sd">    Args:</span>
<span class="sd">        known (bool or str): The &quot;known&quot; status of a context variable in the YAML.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The Hovor certainty equivalent to the &quot;known&quot; parameter provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;Known&quot;</span> <span class="k">if</span> <span class="n">known</span> <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">known</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span> <span class="k">else</span> <span class="s2">&quot;Uncertain&quot;</span></div>


<div class="viewcode-block" id="_convert_to_formula"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._convert_to_formula">[docs]</a><span class="nd">@config</span><span class="p">(</span><span class="n">auto_simplify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_convert_to_formula</span><span class="p">(</span><span class="n">condition</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">And</span><span class="p">,</span> <span class="n">Or</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts an action condition from the YAML to a list of terms for an NNF</span>
<span class="sd">    formula.</span>

<span class="sd">    Args:</span>
<span class="sd">        condition (Dict): An action condition from the YAML.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[nnf.And, nnf.Or]: An NNF formula.</span>

<span class="sd">    **TODO**: Test extensively once arbitrary conversion to DNF becomes viable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">formula_terms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># if we get passed a list, update formula_terms by the conversion of each element</span>
    <span class="c1"># in the list</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">formula_terms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">formula</span>
                <span class="k">for</span> <span class="n">nesting</span> <span class="ow">in</span> <span class="n">condition</span>
                <span class="k">for</span> <span class="n">formula</span> <span class="ow">in</span> <span class="n">_convert_to_formula</span><span class="p">(</span><span class="n">nesting</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># otherwise, inspect the parameter further</span>
        <span class="k">for</span> <span class="n">connective</span><span class="p">,</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="n">condition</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># if the key is not &quot;and&quot; or &quot;or&quot;, then we know we&#39;re dealing with a</span>
            <span class="c1"># context variable and value setting. represent these with Vars.</span>
            <span class="c1"># NOTE: we may want to store the Var to dict mappings so we can reference</span>
            <span class="c1"># them later when constructing new actions from the formula terms.</span>
            <span class="k">if</span> <span class="n">connective</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="s2">&quot;or&quot;</span><span class="p">]:</span>
                <span class="n">formula_terms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="n">Var</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">connective</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">base_key</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">base_value</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">base_key</span><span class="p">,</span> <span class="n">base_value</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if we are dealing with an &quot;and&quot; or &quot;or&quot;, nest the terms in the</span>
                <span class="c1"># respective connective.</span>
                <span class="n">formula_terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">And</span><span class="p">(</span><span class="n">_convert_to_formula</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">connective</span> <span class="o">==</span> <span class="s2">&quot;and&quot;</span>
                    <span class="k">else</span> <span class="n">Or</span><span class="p">(</span><span class="n">_convert_to_formula</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>
                <span class="p">)</span>
    <span class="k">return</span> <span class="n">formula_terms</span></div>


<div class="viewcode-block" id="_convert_to_DNF"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._convert_to_DNF">[docs]</a><span class="nd">@config</span><span class="p">(</span><span class="n">auto_simplify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_convert_to_DNF</span><span class="p">(</span><span class="n">condition</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">And</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts an action condition from the YAML to an NNF formula in Disjunctive</span>
<span class="sd">    Normal Form. Eventually, this would be used for auto-generating equivalent actions</span>
<span class="sd">    based on arbritrary logical formulas.</span>

<span class="sd">    **NOTE**: Will not be in use until issue</span>
<span class="sd">    `#4 &lt;https://github.com/QuMuLab/plan4dial/issues/4&gt;`_ is resolved.</span>

<span class="sd">    Args:</span>
<span class="sd">        condition (Dict): An action condition from the YAML.</span>

<span class="sd">    Returns:</span>
<span class="sd">        nnf.And: The DNF formula that the action condition was converted to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">And</span><span class="p">(</span><span class="n">_convert_to_formula</span><span class="p">(</span><span class="n">condition</span><span class="p">))</span><span class="o">.</span><span class="n">negate</span><span class="p">())</span><span class="o">.</span><span class="n">to_CNF</span><span class="p">()</span><span class="o">.</span><span class="n">negate</span><span class="p">()</span></div>


<div class="viewcode-block" id="_configure_value_setter"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._configure_value_setter">[docs]</a><span class="k">def</span> <span class="nf">_configure_value_setter</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">ctx_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configures the actions in loaded_yaml to allow for value setting. This allows</span>
<span class="sd">    values to be used in preconditions, i.e. ``cuisine: {value: &quot;Mexican&quot;}``.</span>

<span class="sd">    This is done by creating flag context variables that represent the value of the</span>
<span class="sd">    context variable; i.e. &quot;cuisine-value-Mexican&quot;. We need to create flag</span>
<span class="sd">    representations so that value knowledge is reflected in the PDDL and ultimately the</span>
<span class="sd">    generated tree/controller. This flag is what would be used as a precondition to</span>
<span class="sd">    check the value of the context variable.</span>

<span class="sd">    Obviously, the flag values can be set when the context variable becomes known, and</span>
<span class="sd">    reset when the context variable becomes unknown.</span>

<span class="sd">    Args:</span>
<span class="sd">        loaded_yaml (Dict): The loaded YAML configuration.</span>
<span class="sd">        ctx_var (str): The context variable referenced in value-dependent preconditions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">])</span>
    <span class="n">ctx_var_cfg</span> <span class="o">=</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;context_variables&quot;</span><span class="p">][</span><span class="n">ctx_var</span><span class="p">]</span>
    <span class="c1"># possible values the context variable can be set to</span>
    <span class="n">var_options</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">ctx_var_cfg</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ctx_var_cfg</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span>
        <span class="k">else</span> <span class="n">ctx_var_cfg</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># create flag context variables that represent the given ctx_var being set to all</span>
    <span class="c1"># possible values; initialize all as False</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var_options</span><span class="p">:</span>
        <span class="n">option_value_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ctx_var</span><span class="si">}</span><span class="s2">-value-</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;context_variables&quot;</span><span class="p">][</span><span class="n">option_value_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;flag&quot;</span><span class="p">,</span>
            <span class="s2">&quot;init&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="c1"># create a function that sets the relevant &quot;value flag&quot; context variables to true</span>
    <span class="c1"># if the given context variable is known using context dependent determination</span>
    <span class="n">processed</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;set-</span><span class="si">{</span><span class="n">ctx_var</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span>
        <span class="s2">&quot;subtype&quot;</span><span class="p">:</span> <span class="s2">&quot;Context dependent determination&quot;</span><span class="p">,</span>
        <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="o">**</span><span class="p">{</span><span class="n">ctx_var</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;known&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
            <span class="o">**</span><span class="p">{</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ctx_var</span><span class="si">}</span><span class="s2">-value-</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var_options</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s2">&quot;effect&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;set-valid-value&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;oneof&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;outcomes&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">):</span> <span class="p">{</span>
                            <span class="s2">&quot;updates&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ctx_var</span><span class="si">}</span><span class="s2">-value-</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">True</span>
                                <span class="p">},</span>
                            <span class="p">},</span>
                            <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">ctx_var</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">}},</span>
                        <span class="p">}</span>
                        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var_options</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="c1"># whenever we lose knowledge of the context variable, reset all values</span>
    <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">eff</span><span class="p">,</span> <span class="n">eff_config</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">][</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;effect&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">eff_config</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">out</span><span class="p">,</span> <span class="n">out_config</span> <span class="ow">in</span> <span class="n">eff_config</span><span class="p">[</span><span class="n">option</span><span class="p">][</span><span class="s2">&quot;outcomes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="s2">&quot;updates&quot;</span> <span class="ow">in</span> <span class="n">out_config</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">update_var</span><span class="p">,</span> <span class="n">update_cfg</span> <span class="ow">in</span> <span class="n">out_config</span><span class="p">[</span><span class="s2">&quot;updates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">ctx_var</span> <span class="o">==</span> <span class="n">update_var</span> <span class="ow">and</span> <span class="s2">&quot;known&quot;</span> <span class="ow">in</span> <span class="n">update_cfg</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">update_cfg</span><span class="p">[</span><span class="s2">&quot;known&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var_options</span><span class="p">:</span>
                                        <span class="n">processed</span><span class="p">[</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;effect&quot;</span><span class="p">][</span><span class="n">eff</span><span class="p">][</span><span class="n">option</span><span class="p">][</span>
                                            <span class="s2">&quot;outcomes&quot;</span>
                                        <span class="p">][</span><span class="n">out</span><span class="p">][</span><span class="s2">&quot;updates&quot;</span><span class="p">][</span>
                                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ctx_var</span><span class="si">}</span><span class="s2">-value-</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                                        <span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">False</span>
                                        <span class="p">}</span>
    <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed</span></div>


<div class="viewcode-block" id="_base_fallback_setup"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._base_fallback_setup">[docs]</a><span class="k">def</span> <span class="nf">_base_fallback_setup</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets up the default intents, action, and context variables needed to handle</span>
<span class="sd">    fallbacks.</span>

<span class="sd">    Args:</span>
<span class="sd">        loaded_yaml (Dict): The loaded YAML configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># set up the action, intent, and fluents needed for default fallback/unclear user</span>
    <span class="c1"># input</span>
    <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;intents&quot;</span><span class="p">][</span><span class="s2">&quot;fallback&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;utterances&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;entities&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;intents&quot;</span><span class="p">][</span><span class="s2">&quot;utter_ds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;utterances&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;entities&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>
    <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">][</span><span class="s2">&quot;dialogue_statement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_configure_dialogue_statement</span><span class="p">()</span>
    <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;context_variables&quot;</span><span class="p">][</span><span class="s2">&quot;have-message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;flag&quot;</span><span class="p">,</span>
        <span class="s2">&quot;init&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;context_variables&quot;</span><span class="p">][</span><span class="s2">&quot;force-statement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;flag&quot;</span><span class="p">,</span>
        <span class="s2">&quot;init&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span></div>


<div class="viewcode-block" id="_instantiate_custom_actions"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._instantiate_custom_actions">[docs]</a><span class="k">def</span> <span class="nf">_instantiate_custom_actions</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Instantiate custom actions.</span>

<span class="sd">    **NOTE**: All custom action functions must be placed in a file in</span>
<span class="sd">    plan4dial/generate_files/custom_actions.py. The name of the file should be the same</span>
<span class="sd">    name as the function that configures the custom action.</span>

<span class="sd">    **NOTE**: The custom actions are responsible for adding the actions to the</span>
<span class="sd">    configuration. This is because some custom actions add multiple actions, make</span>
<span class="sd">    changes to the context variables, etc. As a rule, the *loaded_yaml* should always be</span>
<span class="sd">    the first parameter.</span>

<span class="sd">    **NOTE**: Custom actions should have &quot;custom&quot; as the `type`, and the name of the</span>
<span class="sd">    function as the `subtype`. Parameters to the function should go in a *parameters*</span>
<span class="sd">    dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        loaded_yaml (Dict): The loaded YAML configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">)</span>
    <span class="c1"># iterate through all actions</span>
    <span class="k">for</span> <span class="n">act</span><span class="p">,</span> <span class="n">act_config</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># if we&#39;re dealing with a custom action</span>
        <span class="k">if</span> <span class="n">act_config</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;custom&quot;</span><span class="p">:</span>
            <span class="c1"># find the appropriate file in the custom_actions folder</span>
            <span class="n">custom_act_name</span> <span class="o">=</span> <span class="n">act_config</span><span class="p">[</span><span class="s2">&quot;subtype&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">custom_act</span> <span class="ow">in</span> <span class="n">getmembers</span><span class="p">(</span>
                <span class="n">import_module</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;for_generating.custom_actions.</span><span class="si">{</span><span class="n">custom_act_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
                <span class="n">isfunction</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">act_name</span><span class="p">,</span> <span class="n">act_function</span> <span class="o">=</span> <span class="n">custom_act</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">custom_act</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">act_name</span> <span class="o">==</span> <span class="n">custom_act_name</span><span class="p">:</span>
                    <span class="n">act_function</span><span class="p">(</span><span class="n">processed</span><span class="p">,</span> <span class="o">**</span><span class="n">act_config</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">])</span>
                    <span class="k">break</span>
            <span class="c1"># delete the custom action instantiation outline</span>
            <span class="k">del</span> <span class="n">processed</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">][</span><span class="n">act</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">processed</span><span class="p">:</span>
        <span class="n">loaded_yaml</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>


<div class="viewcode-block" id="_add_fallbacks"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._add_fallbacks">[docs]</a><span class="k">def</span> <span class="nf">_add_fallbacks</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ensure that non-fallback options can only run if a fallback did not just occur.</span>
<span class="sd">    Add fallback outcomes to actions as necessary.</span>

<span class="sd">    Args:</span>
<span class="sd">        loaded_yaml (Dict): The loaded YAML configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">act</span><span class="p">,</span> <span class="n">act_config</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">fallback</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># for all non-fallback actions, make sure we can only execute that action if a</span>
        <span class="c1"># fallback is not occurring</span>
        <span class="k">if</span> <span class="n">act</span> <span class="o">!=</span> <span class="s2">&quot;dialogue_statement&quot;</span><span class="p">:</span>
            <span class="n">processed</span><span class="p">[</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;condition&quot;</span><span class="p">][</span><span class="s2">&quot;force-statement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
            <span class="c1"># check if either fallbacks are disabled or we have a dialogue action</span>
            <span class="c1"># (fallbacks are only needed for dialogue actions)</span>
            <span class="n">fallback</span> <span class="o">=</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">act_config</span><span class="p">[</span><span class="s2">&quot;disable-fallback&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;disable-fallback&quot;</span> <span class="ow">in</span> <span class="n">act_config</span>
                <span class="k">else</span> <span class="n">act_config</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;dialogue&quot;</span>
            <span class="p">)</span>
            <span class="c1"># if this action has fallbacks enabled, and we haven&#39;t specified custom</span>
            <span class="c1"># fallback message variants, add these as default</span>
            <span class="k">if</span> <span class="n">fallback</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;fallback_message_variants&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">act_config</span><span class="p">:</span>
                    <span class="n">processed</span><span class="p">[</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;fallback_message_variants&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="s2">&quot;Sorry, I couldn&#39;t understand that input.&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Sorry, I didn&#39;t quite get that.&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
        <span class="c1"># if this action has fallbacks enabled, add fallback outcomes as necessary</span>
        <span class="k">for</span> <span class="n">eff</span><span class="p">,</span> <span class="n">eff_config</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">][</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;effect&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">fallback</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">eff_config</span><span class="p">:</span>
                    <span class="n">processed</span><span class="p">[</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;effect&quot;</span><span class="p">][</span><span class="n">eff</span><span class="p">][</span><span class="n">option</span><span class="p">][</span><span class="s2">&quot;outcomes&quot;</span><span class="p">][</span>
                        <span class="s2">&quot;fallback&quot;</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="n">_configure_fallback</span><span class="p">()</span>
    <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed</span></div>


<div class="viewcode-block" id="_add_follow_ups_and_responses"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._add_follow_ups_and_responses">[docs]</a><span class="k">def</span> <span class="nf">_add_follow_ups_and_responses</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configures follow up actions and responses where they were specified in th</span>
<span class="sd">    YAML.</span>

<span class="sd">    Follow ups are actions that are forced to take place after an outcome. Responses</span>
<span class="sd">    are messages that the agent must utter after an outcome.</span>

<span class="sd">    **NOTE**: As it stands, follow ups only force the action that you specify and</span>
<span class="sd">    disable all others. This means that for actions that, for example, lead into</span>
<span class="sd">    clarifications, those clarifications will not be forced too. A more complex</span>
<span class="sd">    configuration for robust follow_up functionality (as well as more description of</span>
<span class="sd">    the issue) is detailed in `#5 &lt;https://github.com/QuMuLab/plan4dial/issues/5&gt;`_,</span>
<span class="sd">    but this bare-bones specification can be safely used in the meantime.</span>

<span class="sd">    Args:</span>
<span class="sd">        loaded_yaml (Dict): The loaded YAML configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">])</span>
    <span class="n">forced_acts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">eff</span><span class="p">,</span> <span class="n">eff_config</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">][</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;effect&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">eff_config</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">out</span><span class="p">,</span> <span class="n">out_config</span> <span class="ow">in</span> <span class="n">eff_config</span><span class="p">[</span><span class="n">option</span><span class="p">][</span><span class="s2">&quot;outcomes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">next_outcome</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">out_config</span><span class="p">)</span>
                    <span class="c1"># if a follow up was specified, set the forcing__{action} flag to</span>
                    <span class="c1"># True and keep track of which action was forced</span>
                    <span class="k">if</span> <span class="s2">&quot;follow_up&quot;</span> <span class="ow">in</span> <span class="n">next_outcome</span><span class="p">:</span>
                        <span class="n">forced</span> <span class="o">=</span> <span class="n">next_outcome</span><span class="p">[</span><span class="s2">&quot;follow_up&quot;</span><span class="p">]</span>
                        <span class="n">forcing_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;forcing__</span><span class="si">{</span><span class="n">forced</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="k">if</span> <span class="s2">&quot;updates&quot;</span> <span class="ow">in</span> <span class="n">next_outcome</span><span class="p">:</span>
                            <span class="n">next_outcome</span><span class="p">[</span><span class="s2">&quot;updates&quot;</span><span class="p">][</span><span class="n">forcing_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">next_outcome</span><span class="p">[</span><span class="s2">&quot;updates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">forcing_name</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}</span>
                        <span class="n">forced_acts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">forced</span><span class="p">)</span>
                    <span class="c1"># force a message if a response was indicated</span>
                    <span class="k">if</span> <span class="s2">&quot;response_variants&quot;</span> <span class="ow">in</span> <span class="n">next_outcome</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s2">&quot;updates&quot;</span> <span class="ow">in</span> <span class="n">next_outcome</span><span class="p">:</span>
                            <span class="n">next_outcome</span><span class="p">[</span><span class="s2">&quot;updates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                                <span class="n">_configure_force_message_true</span><span class="p">()</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">next_outcome</span><span class="p">[</span><span class="s2">&quot;updates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_configure_force_message_true</span><span class="p">()</span>
                    <span class="n">processed</span><span class="p">[</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;effect&quot;</span><span class="p">][</span><span class="n">eff</span><span class="p">][</span><span class="n">option</span><span class="p">][</span><span class="s2">&quot;outcomes&quot;</span><span class="p">][</span>
                        <span class="n">out</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="n">next_outcome</span>
    <span class="n">with_forced</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>
    <span class="c1"># iterate through all the actions that are going to be forced at some point</span>
    <span class="k">for</span> <span class="n">forced</span> <span class="ow">in</span> <span class="n">forced_acts</span><span class="p">:</span>
        <span class="n">forcing_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;forcing__</span><span class="si">{</span><span class="n">forced</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># iterate through all actions</span>
        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">processed</span><span class="p">:</span>
            <span class="c1"># don&#39;t lock the fallback so we can fallback on a forced action if needed</span>
            <span class="c1"># don&#39;t lock the forced action itself, obviously</span>
            <span class="k">if</span> <span class="n">act</span> <span class="o">!=</span> <span class="n">forced</span> <span class="ow">and</span> <span class="n">act</span> <span class="o">!=</span> <span class="s2">&quot;dialogue_statement&quot;</span><span class="p">:</span>
                <span class="n">with_forced</span><span class="p">[</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;condition&quot;</span><span class="p">][</span><span class="n">forcing_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="c1"># for all actions that are being forced, any outcome that IS NOT a fallback</span>
        <span class="c1"># will end the force</span>
        <span class="k">for</span> <span class="n">eff</span><span class="p">,</span> <span class="n">eff_config</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">][</span><span class="n">forced</span><span class="p">][</span><span class="s2">&quot;effect&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">eff_config</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">out</span><span class="p">,</span> <span class="n">out_config</span> <span class="ow">in</span> <span class="n">with_forced</span><span class="p">[</span><span class="n">forced</span><span class="p">][</span><span class="s2">&quot;effect&quot;</span><span class="p">][</span><span class="n">eff</span><span class="p">][</span><span class="n">option</span><span class="p">][</span>
                    <span class="s2">&quot;outcomes&quot;</span>
                <span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="s2">&quot;intent&quot;</span> <span class="ow">in</span> <span class="n">out_config</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">out_config</span><span class="p">[</span><span class="s2">&quot;intent&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;fallback&quot;</span><span class="p">:</span>
                            <span class="n">reset_force</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">reset_force</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">reset_force</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s2">&quot;updates&quot;</span> <span class="ow">in</span> <span class="n">out_config</span><span class="p">:</span>
                            <span class="n">out_config</span><span class="p">[</span><span class="s2">&quot;updates&quot;</span><span class="p">][</span><span class="n">forcing_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">out_config</span><span class="p">[</span><span class="s2">&quot;updates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">forcing_name</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}}</span>
        <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;context_variables&quot;</span><span class="p">][</span><span class="n">forcing_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;flag&quot;</span><span class="p">,</span> <span class="s2">&quot;init&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
    <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">with_forced</span></div>


<div class="viewcode-block" id="_duplicate_for_or_condition"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._duplicate_for_or_condition">[docs]</a><span class="k">def</span> <span class="nf">_duplicate_for_or_condition</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates equivalent actions to those with an &quot;or&quot; precondition by splitting them</span>
<span class="sd">    up into separate actions.</span>

<span class="sd">    **NOTE**: ARBITRARY FORMULAS ARE NOT YET HANDLED (see</span>
<span class="sd">    `#4 &lt;https://github.com/QuMuLab/plan4dial/issues/4&gt;`_). Should not be deployed yet.</span>

<span class="sd">    Args:</span>
<span class="sd">        loaded_yaml (Dict): The loaded YAML configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">act</span><span class="p">,</span> <span class="n">act_cfg</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">cond</span><span class="p">,</span> <span class="n">cond_cfg</span> <span class="ow">in</span> <span class="n">act_cfg</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># currently only handles &quot;or&quot;s and &quot;or&quot;s of &quot;ands&quot; (when multiple</span>
            <span class="c1"># conditions are listed under one bullet)</span>
            <span class="k">if</span> <span class="n">cond</span> <span class="o">==</span> <span class="s2">&quot;or&quot;</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="c1"># for each or condition, create a new action with that condition and</span>
                <span class="c1"># none of the other ones in the or clause</span>
                <span class="k">for</span> <span class="n">or_cond</span> <span class="ow">in</span> <span class="n">cond_cfg</span><span class="p">:</span>
                    <span class="n">new_cond</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">act_cfg</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">])</span>
                    <span class="k">del</span> <span class="n">new_cond</span><span class="p">[</span><span class="s2">&quot;or&quot;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">or_cond</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">new_cond</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                    <span class="n">next_act_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">act</span><span class="si">}</span><span class="s2">-or-</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">processed</span><span class="p">[</span><span class="n">next_act_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">processed</span><span class="p">[</span><span class="n">act</span><span class="p">])</span>
                    <span class="n">processed</span><span class="p">[</span><span class="n">next_act_name</span><span class="p">][</span><span class="s2">&quot;condition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_cond</span>
                    <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">del</span> <span class="n">processed</span><span class="p">[</span><span class="n">act</span><span class="p">]</span>
    <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed</span></div>


<div class="viewcode-block" id="_duplicate_for_or_when_condition"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._duplicate_for_or_when_condition">[docs]</a><span class="k">def</span> <span class="nf">_duplicate_for_or_when_condition</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates equivalent &quot;when&quot; expressions to those with an &quot;or&quot; condition by</span>
<span class="sd">    splitting them up into separate conditions.</span>

<span class="sd">    **NOTE**: ARBITRARY FORMULAS ARE NOT YET HANDLED (see</span>
<span class="sd">    `#3 &lt;https://github.com/QuMuLab/plan4dial/issues/3&gt;`_ and</span>
<span class="sd">    `#4 &lt;https://github.com/QuMuLab/plan4dial/issues/4&gt;`_). Should not be deployed yet.</span>

<span class="sd">    Args:</span>
<span class="sd">        loaded_yaml (Dict): The loaded YAML configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">eff</span><span class="p">,</span> <span class="n">eff_config</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">][</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;effect&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">eff_config</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">out</span><span class="p">,</span> <span class="n">out_config</span> <span class="ow">in</span> <span class="n">eff_config</span><span class="p">[</span><span class="n">option</span><span class="p">][</span><span class="s2">&quot;outcomes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="s2">&quot;updates&quot;</span> <span class="ow">in</span> <span class="n">out_config</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">update_var</span><span class="p">,</span> <span class="n">update_cfg</span> <span class="ow">in</span> <span class="n">out_config</span><span class="p">[</span><span class="s2">&quot;updates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="c1"># for now, assume we only use &quot;and&quot; explicitly to stack</span>
                            <span class="c1"># &quot;when&quot; expressions</span>
                            <span class="k">if</span> <span class="n">update_var</span> <span class="o">==</span> <span class="s2">&quot;and&quot;</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">when_expr</span> <span class="ow">in</span> <span class="n">update_cfg</span><span class="p">:</span>
                                    <span class="k">for</span> <span class="n">when_cond</span><span class="p">,</span> <span class="n">when_cond_cfg</span> <span class="ow">in</span> <span class="n">when_expr</span><span class="p">[</span><span class="s2">&quot;when&quot;</span><span class="p">][</span>
                                        <span class="s2">&quot;condition&quot;</span>
                                    <span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                        <span class="k">if</span> <span class="n">when_cond</span> <span class="o">==</span> <span class="s2">&quot;or&quot;</span><span class="p">:</span>
                                            <span class="c1"># iterate through each &quot;or&quot; condition</span>
                                            <span class="k">for</span> <span class="n">or_cond</span> <span class="ow">in</span> <span class="n">when_cond_cfg</span><span class="p">:</span>
                                                <span class="n">new_when</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">when_expr</span><span class="p">)</span>
                                                <span class="k">del</span> <span class="n">new_when</span><span class="p">[</span><span class="s2">&quot;when&quot;</span><span class="p">][</span><span class="s2">&quot;condition&quot;</span><span class="p">][</span><span class="s2">&quot;or&quot;</span><span class="p">]</span>
                                                <span class="c1"># create new expressions for each</span>
                                                <span class="c1"># condition</span>
                                                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">or_cond</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                                    <span class="n">new_when</span><span class="p">[</span><span class="s2">&quot;when&quot;</span><span class="p">][</span><span class="s2">&quot;condition&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                                                <span class="n">processed</span><span class="p">[</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;effect&quot;</span><span class="p">][</span><span class="n">eff</span><span class="p">][</span><span class="n">option</span><span class="p">][</span>
                                                    <span class="s2">&quot;outcomes&quot;</span>
                                                <span class="p">][</span><span class="n">out</span><span class="p">][</span><span class="s2">&quot;updates&quot;</span><span class="p">][</span><span class="n">update_var</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                                    <span class="n">new_when</span>
                                                <span class="p">)</span>
                                    <span class="n">processed</span><span class="p">[</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;effect&quot;</span><span class="p">][</span><span class="n">eff</span><span class="p">][</span><span class="n">option</span><span class="p">][</span><span class="s2">&quot;outcomes&quot;</span><span class="p">][</span>
                                        <span class="n">out</span>
                                    <span class="p">][</span><span class="s2">&quot;updates&quot;</span><span class="p">][</span><span class="n">update_var</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">when_expr</span><span class="p">)</span>
    <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed</span></div>


<div class="viewcode-block" id="_add_value_setters"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._add_value_setters">[docs]</a><span class="k">def</span> <span class="nf">_add_value_setters</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configures value setters when an action is contingent on the string value of a</span>
<span class="sd">    context variable. Resets the precondition of these actions to rely on the flag</span>
<span class="sd">    values that represent the true value of the context variable.</span>

<span class="sd">    Args:</span>
<span class="sd">        loaded_yaml (Dict): The loaded YAML configuration.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AssertionError: Raised if the user tried to specify an invalid value for a</span>
<span class="sd">            context variable in a precondition.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">act</span><span class="p">,</span> <span class="n">act_cfg</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">cond</span><span class="p">,</span> <span class="n">cond_cfg</span> <span class="ow">in</span> <span class="n">act_cfg</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;value&quot;</span> <span class="ow">in</span> <span class="n">cond_cfg</span><span class="p">:</span>
                <span class="n">option</span> <span class="o">=</span> <span class="n">cond_cfg</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">option</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">option</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;context_variables&quot;</span><span class="p">][</span><span class="n">cond</span><span class="p">][</span><span class="s2">&quot;options&quot;</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s1">&#39;Cannot specify the value &quot;</span><span class="si">{</span><span class="n">option</span><span class="si">}</span><span class="s1">&quot; for the context </span><span class="se">\</span>
<span class="s1">                                variable &quot;</span><span class="si">{</span><span class="n">cond</span><span class="si">}</span><span class="s1">&quot;.&#39;</span>
                        <span class="p">)</span>
                    <span class="c1"># if not done already, create new &quot;value-setting&quot; actions,</span>
                    <span class="c1"># conditions, etc.</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cond</span><span class="si">}</span><span class="s2">-value-</span><span class="si">{</span><span class="n">option</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="ow">not</span> <span class="ow">in</span> <span class="n">processed</span><span class="p">[</span><span class="s2">&quot;context_variables&quot;</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">_configure_value_setter</span><span class="p">(</span><span class="n">processed</span><span class="p">,</span> <span class="n">cond</span><span class="p">)</span>
                    <span class="c1"># reset old condition to the refactored condition so we can specify</span>
                    <span class="c1"># value only delete the value portion (may still have &quot;known&quot;)</span>
                    <span class="k">del</span> <span class="n">processed</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">][</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;condition&quot;</span><span class="p">][</span><span class="n">cond</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                    <span class="c1"># delete whole condition if empty</span>
                    <span class="k">if</span> <span class="n">processed</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">][</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;condition&quot;</span><span class="p">][</span><span class="n">cond</span><span class="p">]</span> <span class="o">==</span> <span class="p">{}:</span>
                        <span class="k">del</span> <span class="n">processed</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">][</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;condition&quot;</span><span class="p">][</span><span class="n">cond</span><span class="p">]</span>
                    <span class="c1"># replace</span>
                    <span class="n">processed</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">][</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;condition&quot;</span><span class="p">][</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cond</span><span class="si">}</span><span class="s2">-value-</span><span class="si">{</span><span class="n">option</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
    <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">],</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;context_variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">processed</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">],</span>
        <span class="n">processed</span><span class="p">[</span><span class="s2">&quot;context_variables&quot;</span><span class="p">],</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="_convert_ctx_var"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._convert_ctx_var">[docs]</a><span class="k">def</span> <span class="nf">_convert_ctx_var</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts the context variables from how they were formatted in the YAML to the</span>
<span class="sd">    JSON configuration that Hovor requires.</span>

<span class="sd">    Args:</span>
<span class="sd">        loaded_yaml (Dict): The loaded YAML configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;context_variables&quot;</span><span class="p">])</span>
    <span class="c1"># convert context variables</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="p">{</span><span class="n">var</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;context_variables&quot;</span><span class="p">]}</span>
    <span class="k">for</span> <span class="n">ctx_var</span><span class="p">,</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;context_variables&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">json_ctx_var</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">json_ctx_var</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;enum&quot;</span><span class="p">:</span>
            <span class="c1"># don&#39;t include variations in the config</span>
            <span class="n">json_ctx_var</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">]</span>
        <span class="c1"># for flags/fflags, the config is the initial setting</span>
        <span class="k">elif</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;flag&quot;</span> <span class="ow">or</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;fflag&quot;</span><span class="p">:</span>
            <span class="n">json_ctx_var</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
            <span class="c1"># add information to the config as necessary</span>
            <span class="n">json_ctx_var</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s2">&quot;options&quot;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
                <span class="n">json_ctx_var</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">][</span><span class="s2">&quot;options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;extraction&quot;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
                <span class="n">json_ctx_var</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">][</span><span class="s2">&quot;extraction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;extraction&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;known&quot;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
            <span class="n">json_ctx_var</span><span class="p">[</span><span class="s2">&quot;known&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;known&quot;</span><span class="p">]</span>
        <span class="n">processed</span><span class="p">[</span><span class="n">ctx_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_ctx_var</span>
    <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;context_variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed</span></div>


<div class="viewcode-block" id="_convert_intents"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._convert_intents">[docs]</a><span class="k">def</span> <span class="nf">_convert_intents</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts the intents from how they were formatted in the YAML to the JSON</span>
<span class="sd">    configuration that Hovor requires.</span>

<span class="sd">    Args:</span>
<span class="sd">        loaded_yaml (Dict): The loaded YAML configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;intents&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">intent</span><span class="p">,</span> <span class="n">intent_cfg</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;intents&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">cur_intent</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cur_intent</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># add the $ identifier to all variables</span>
        <span class="k">if</span> <span class="s2">&quot;entities&quot;</span> <span class="ow">in</span> <span class="n">intent_cfg</span><span class="p">:</span>
            <span class="n">cur_intent</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">intent_cfg</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">]])</span>
        <span class="n">cur_intent</span><span class="p">[</span><span class="s2">&quot;utterances&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intent_cfg</span><span class="p">[</span><span class="s2">&quot;utterances&quot;</span><span class="p">]</span>
        <span class="n">cur_intent</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fallback&quot;</span> <span class="k">if</span> <span class="n">intent</span> <span class="o">==</span> <span class="s2">&quot;fallback&quot;</span> <span class="k">else</span> <span class="s2">&quot;regular&quot;</span>
        <span class="n">processed</span><span class="p">[</span><span class="n">intent</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur_intent</span>
    <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;intents&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed</span></div>


<div class="viewcode-block" id="_convert_actions"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser._convert_actions">[docs]</a><span class="k">def</span> <span class="nf">_convert_actions</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts the actions from how they were formatted in the YAML to the JSON</span>
<span class="sd">    configuration that Hovor requires.</span>

<span class="sd">    Args:</span>
<span class="sd">        loaded_yaml (Dict): The loaded YAML configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]:</span>
        <span class="c1"># convert preconditions</span>
        <span class="n">json_config_cond</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">][</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;condition&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">cond</span><span class="p">,</span> <span class="n">cond_cfg</span> <span class="ow">in</span> <span class="n">condition</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">cond_config_key</span><span class="p">,</span> <span class="n">cond_config_val</span> <span class="ow">in</span> <span class="n">cond_cfg</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cond_config_key</span> <span class="o">==</span> <span class="s2">&quot;known&quot;</span><span class="p">:</span>
                    <span class="n">json_config_cond</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">([</span><span class="n">cond</span><span class="p">,</span> <span class="s2">&quot;Known&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">cond_config_val</span> <span class="k">else</span> <span class="p">[</span><span class="n">cond</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">cond_config_val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span>
                        <span class="k">else</span> <span class="p">[</span><span class="n">cond</span><span class="p">,</span> <span class="s2">&quot;Uncertain&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">cond_config_key</span> <span class="o">==</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span>
                    <span class="n">json_config_cond</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">cond</span><span class="p">,</span> <span class="n">cond_config_val</span><span class="p">])</span>
        <span class="n">processed</span><span class="p">[</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;condition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_config_cond</span>
        <span class="c1"># convert effects</span>
        <span class="k">for</span> <span class="n">eff</span><span class="p">,</span> <span class="n">eff_config</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">][</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;effect&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">converted_eff</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">eff_config</span><span class="p">)</span>
            <span class="c1"># prevent effect name overlapping (can be an issue in hovor, even across</span>
            <span class="c1"># actions)</span>
            <span class="n">converted_eff</span><span class="p">[</span><span class="s2">&quot;global-outcome-name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">act</span><span class="si">}</span><span class="s2">__</span><span class="si">{</span><span class="n">eff</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">intents</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">eff_config</span><span class="p">:</span>
                <span class="n">converted_eff</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">option</span>
                <span class="n">outcomes_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">out</span><span class="p">,</span> <span class="n">out_config</span> <span class="ow">in</span> <span class="n">eff_config</span><span class="p">[</span><span class="n">option</span><span class="p">][</span><span class="s2">&quot;outcomes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">next_outcome</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">out_config</span><span class="p">)</span>
                    <span class="c1"># reformat name</span>
                    <span class="n">next_outcome</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">act</span><span class="si">}</span><span class="s2">_DETDUP_</span><span class="si">{</span><span class="n">act</span><span class="si">}</span><span class="s2">__</span><span class="si">{</span><span class="n">eff</span><span class="si">}</span><span class="s2">-EQ-</span><span class="si">{</span><span class="n">out</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="c1"># use blank intent if no intent was specified</span>
                    <span class="k">if</span> <span class="s2">&quot;intent&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out_config</span><span class="p">:</span>
                        <span class="n">next_outcome</span><span class="p">[</span><span class="s2">&quot;intent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">intents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_config</span><span class="p">[</span><span class="s2">&quot;intent&quot;</span><span class="p">])</span>
                    <span class="n">next_outcome</span><span class="p">[</span><span class="s2">&quot;assignments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">if</span> <span class="s2">&quot;updates&quot;</span> <span class="ow">in</span> <span class="n">out_config</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">update_var</span><span class="p">,</span> <span class="n">update_cfg</span> <span class="ow">in</span> <span class="n">out_config</span><span class="p">[</span><span class="s2">&quot;updates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">next_outcome</span><span class="p">[</span><span class="s2">&quot;updates&quot;</span><span class="p">][</span><span class="n">update_var</span><span class="p">][</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">update_var</span>
                            <span class="c1"># set the assignments and certainty based on the &quot;known&quot;</span>
                            <span class="c1"># settings that were updated</span>
                            <span class="k">if</span> <span class="s2">&quot;known&quot;</span> <span class="ow">in</span> <span class="n">update_cfg</span><span class="p">:</span>
                                <span class="n">next_outcome</span><span class="p">[</span><span class="s2">&quot;assignments&quot;</span><span class="p">][</span>
                                    <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">update_var</span><span class="si">}</span><span class="s2">&quot;</span>
                                <span class="p">]</span> <span class="o">=</span> <span class="n">configure_assignments</span><span class="p">(</span><span class="n">update_cfg</span><span class="p">[</span><span class="s2">&quot;known&quot;</span><span class="p">])</span>
                                <span class="n">next_outcome</span><span class="p">[</span><span class="s2">&quot;updates&quot;</span><span class="p">][</span><span class="n">update_var</span><span class="p">][</span>
                                    <span class="s2">&quot;certainty&quot;</span>
                                <span class="p">]</span> <span class="o">=</span> <span class="n">_configure_certainty</span><span class="p">(</span><span class="n">update_cfg</span><span class="p">[</span><span class="s2">&quot;known&quot;</span><span class="p">])</span>
                                <span class="k">del</span> <span class="n">next_outcome</span><span class="p">[</span><span class="s2">&quot;updates&quot;</span><span class="p">][</span><span class="n">update_var</span><span class="p">][</span><span class="s2">&quot;known&quot;</span><span class="p">]</span>
                            <span class="c1"># set value to None if not specified (i.e. if just setting</span>
                            <span class="c1"># known: False)</span>
                            <span class="k">if</span> <span class="s2">&quot;value&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">update_cfg</span><span class="p">:</span>
                                <span class="n">next_outcome</span><span class="p">[</span><span class="s2">&quot;updates&quot;</span><span class="p">][</span><span class="n">update_var</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="c1"># JSON interpretations are handled in the most</span>
                            <span class="c1"># straightforward way by Hovor (as opposed to spel, which</span>
                            <span class="c1"># requires a specific format)</span>
                            <span class="n">next_outcome</span><span class="p">[</span><span class="s2">&quot;updates&quot;</span><span class="p">][</span><span class="n">update_var</span><span class="p">][</span>
                                <span class="s2">&quot;interpretation&quot;</span>
                            <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;json&quot;</span>
                    <span class="n">outcomes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_outcome</span><span class="p">)</span>
                <span class="n">converted_eff</span><span class="p">[</span><span class="s2">&quot;outcomes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outcomes_list</span>
                <span class="k">del</span> <span class="n">converted_eff</span><span class="p">[</span><span class="n">option</span><span class="p">]</span>
                <span class="n">processed</span><span class="p">[</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;effect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">converted_eff</span>
        <span class="c1"># add the intents in a separate section</span>
        <span class="k">if</span> <span class="n">intents</span><span class="p">:</span>
            <span class="n">processed</span><span class="p">[</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;intents&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">intent</span> <span class="ow">in</span> <span class="n">intents</span><span class="p">:</span>
                <span class="c1"># don&#39;t consider null intents</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">intent</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">intent</span> <span class="ow">in</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;intents&quot;</span><span class="p">]:</span>
                        <span class="n">processed</span><span class="p">[</span><span class="n">act</span><span class="p">][</span><span class="s2">&quot;intents&quot;</span><span class="p">][</span><span class="n">intent</span><span class="p">]</span> <span class="o">=</span> <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;intents&quot;</span><span class="p">][</span>
                            <span class="n">intent</span>
                        <span class="p">]</span>
    <span class="n">loaded_yaml</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed</span></div>


<div class="viewcode-block" id="convert_yaml"><a class="viewcode-back" href="../../../../generated/plan4dial.for_generating.parsers.json_config_parser.html#plan4dial.for_generating.parsers.json_config_parser.convert_yaml">[docs]</a><span class="k">def</span> <span class="nf">convert_yaml</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates the JSON configuration required by Hovor from the provided YAML file.</span>
<span class="sd">    First preprocesses the YAML, adding clarification actions, follow-up actions, etc.,</span>
<span class="sd">    then finally converts everything into Hovor format.</span>

<span class="sd">    Args:</span>
<span class="sd">        loaded_yaml (Dict): The loaded YAML configuration.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict: The JSON configuration required by Hovor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_base_fallback_setup</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">)</span>
    <span class="n">_instantiate_custom_actions</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">)</span>
    <span class="n">_add_fallbacks</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">)</span>
    <span class="n">_add_follow_ups_and_responses</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">)</span>
    <span class="n">_duplicate_for_or_condition</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">)</span>
    <span class="n">_duplicate_for_or_when_condition</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">)</span>
    <span class="n">_add_value_setters</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">)</span>
    <span class="n">_convert_ctx_var</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">)</span>
    <span class="n">_convert_intents</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">)</span>
    <span class="n">_convert_actions</span><span class="p">(</span><span class="n">loaded_yaml</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loaded_yaml</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Rebecca De Venezia @ QuMuLab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>